// 执行方式 gradlew.bat -q -b buildJar.gradle makeJar
// 执行方式 gradlew.bat -q -b buildJar.gradle execJar
// java -jar jspider/build/sdk/jar/spider.jar

def desSdkDir = 'jspider/build/sdk/'

def jarInclude = new File('jspider/libs').list()

task cleanJar(type: Delete) {
    delete desSdkDir + 'jar'
}

// 生成Jar包。
task makeJar(dependsOn: [cleanJar], type: Jar) {
    doFirst {
        println 'start makeJar.'
    }

    def src = []
    def file = new File('jspider/build/classes/java/main')
    src.add(file)

    for (int i = 0; i < jarInclude.size(); i++) {
        from project.zipTree('jspider/libs/' + jarInclude[i])
    }

    // set.
    archiveName = 'spider.jar'
    from src
    destinationDir = new File(desSdkDir, 'jar')
    setVersion version

    manifest {
        attributes 'Main-class': 'com.hy.jspider.Main'
    }
}

task execJar(type: Exec) {
    commandLine 'cmd', '/c',
            'java', '-jar',
            desSdkDir + 'jar/spider.jar'

    // file.else console.
//    standardOutput = new FileOutputStream(new File(projectDir, "jspider/build/exec.txt"))
}